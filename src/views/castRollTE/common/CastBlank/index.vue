<template>
  <div class="part-box" style="height: 350px">
    <div class="part-title">铸坯属性</div>
    <div class="part-content">
      <el-form :inline="true" :model="billetForm" label-width="220px">
        <el-row>
          <el-col :span="11">
            <el-form-item label="铸坯形状">
              <el-select
                v-model="billetForm.shape"
                placeholder="请选择"
                clearable
                style="width: 200px"
              >
                <el-option
                  v-for="item in shapeList"
                  :key="item.value"
                  :label="item.label"
                  :value="item.value"
                />
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="13">
            <el-form-item label="铸坯尺寸(mm)">
              <div class="mr-2 w-[67px]">
                <el-input
                  v-model="billetForm.billetSize.height"
                  placeholder="高"
                  type="number"
                />
              </div>
              <div class="mr-2 w-[67px]">
                <el-input
                  v-model="billetForm.billetSize.width"
                  placeholder="宽"
                  type="number"
                />
              </div>
              <div class="mr-2 w-[67px]">
                <el-input
                  v-model="billetForm.billetSize.length"
                  placeholder="长"
                  type="number"
                  :disabled="route.path == '/continuousCastRoll'"
                />
              </div>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row>
          <el-col :span="11">
            <el-form-item label="铸坯表面中心温度" style="width: 500px">
              <div class="input-unit">
                <el-input
                  v-model="billetForm.surfaceCenterTemperature.head"
                  placeholder="头部"
                  type="number"
                  style="width: 95px"
                />
                <span class="unit">°C</span>
              </div>
              <div class="input-unit">
                <el-input
                  v-model="billetForm.surfaceCenterTemperature.tail"
                  placeholder="尾部"
                  type="number"
                  :disabled="route.path == '/continuousCastRoll'"
                  style="width: 95px"
                />
                <span class="unit">°C</span>
              </div>
            </el-form-item>
          </el-col>
          <el-col :span="13">
            <el-form-item label="铸坯倒角">
              <div class="input-unit">
                <el-input
                  v-model="billetForm.chamfer"
                  placeholder="请输入"
                  class="input"
                  type="number"
                  style="width: 200px"
                />
                <span class="unit" style="top: 6px; right: 20px">mm</span>
              </div>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row>
          <el-col :span="11">
            <el-form-item label="铸坯角度温度" style="width: 500px">
              <div class="input-unit">
                <el-input
                  v-model="billetForm.angularTemperature.head"
                  placeholder="头部"
                  type="number"
                  style="width: 95px"
                />
                <span class="unit">°C</span>
              </div>
              <div class="input-unit">
                <el-input
                  v-model="billetForm.angularTemperature.tail"
                  placeholder="尾部"
                  type="number"
                  :disabled="route.path == '/continuousCastRoll'"
                  style="width: 95px"
                />
                <span class="unit">°C</span>
              </div>
            </el-form-item>
          </el-col>
          <el-col :span="13">
            <el-form-item label="铸坯密度">
              <div class="input-unit">
                <el-input
                  v-model="billetForm.density"
                  placeholder="请输入"
                  type="number"
                  style="width: 200px"
                />
                <span class="unit">kg/m³</span>
              </div>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row>
          <el-col :span="11">
            <el-form-item label="铸坯中心温度" style="width: 500px">
              <div class="input-unit">
                <el-input
                  v-model="billetForm.centerTemperature.head"
                  placeholder="头部"
                  type="number"
                  style="width: 95px"
                />
                <span class="unit">°C</span>
              </div>
              <div class="input-unit">
                <el-input
                  v-model="billetForm.centerTemperature.tail"
                  placeholder="尾部"
                  type="number"
                  :disabled="route.path == '/continuousCastRoll'"
                  style="width: 95px"
                />
                <span class="unit">°C</span>
              </div>
            </el-form-item>
          </el-col>
          <el-col :span="13">
            <el-form-item label="连铸拉速">
              <div class="input-unit">
                <el-input
                  v-model="billetForm.speed"
                  placeholder="请输入"
                  type="number"
                  style="width: 200px"
                />
                <span class="unit">m/min</span>
              </div>
            </el-form-item>
          </el-col>
        </el-row>

        <el-form-item label="铸坯文件上传">
          <div class="input-unit">
            <el-upload
              v-model:file-list="fileList"
              class="upload-demo"
              action="https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15"
              multiple
              :on-preview="handlePreview"
              :on-remove="handleRemove"
              :before-remove="beforeRemove"
              :limit="3"
              :on-exceed="handleExceed"
            >
              <v-btn variant="outlined" class="custom-btn">选择文件</v-btn>
            </el-upload>
          </div>
        </el-form-item>
      </el-form>
    </div>
  </div>
</template>

<script setup>
import { useRoute } from "vue-router";

const route = useRoute();

const billetForm = reactive({
  shape: "",
  billetSize: {
    length: "",
    width: "",
    height: "",
  },
  surfaceCenterTemperature: {
    head: "",
    tail: "",
  },
  chamfer: "",
  angularTemperature: {
    head: "",
    tail: "",
  },
  density: "",
  centerTemperature: {
    head: "",
    tail: "",
  },
  speed: "",
});

const shapeList = ref([
  {
    label: "方坯",
    value: "1",
  },
  {
    label: "矩形坯",
    value: "2",
  },
  {
    label: "圆坯",
    value: "3",
  },
]);

// 文件上传
const fileList = ref([]);

const handleRemove = (file, uploadFiles) => {
  console.log(file, uploadFiles);
};

const handlePreview = (uploadFile) => {
  console.log(uploadFile);
};

const handleExceed = (files, uploadFiles) => {
  ElMessage.warning(
    `The limit is 3, you selected ${files.length} files this time, add up to ${
      files.length + uploadFiles.length
    } totally`
  );
};

const beforeRemove = (uploadFile, uploadFiles) => {
  return ElMessageBox.confirm(
    `Cancel the transfer of ${uploadFile.name} ?`
  ).then(
    () => true,
    () => false
  );
};

// 返回给父组件的数据
const getBillet = () => {
  const {
    shape,
    chamfer,
    density,
    speed,
    billetSize,
    surfaceCenterTemperature,
    centerTemperature,
    angularTemperature,
  } = billetForm;

  // 连续铸轧尾部温度默认传-1
  if (route.path == "/continuousCastRoll") {
    surfaceCenterTemperature.tail = -1;
    centerTemperature.tail = -1;
    angularTemperature.tail = -1;
  }

  let data = {
    shape,
    chamfer,
    density,
    speed,
    size: [billetSize.height, billetSize.width, billetSize.length],
    temperature: [
      surfaceCenterTemperature.head, // 表面
      surfaceCenterTemperature.tail,
      centerTemperature.head, // 中心
      centerTemperature.tail,
      angularTemperature.head, // 尾部
      angularTemperature.tail,
    ],
  };

  return data;
};

defineExpose({
  getBillet,
});
</script>

<style lang="scss" scoped>
.part-box {
  background: #fff;

  .part-title {
    height: 50px;
    display: flex;
    align-items: center;
    background-color: #f7f9fa;
    font-size: 15px;
    padding: 20px;
    border-radius: 4px;
    margin-bottom: 30px;

    &::before {
      content: "";
      display: block;
      width: 2px;
      height: 20px;
      background-color: #0c5fff;
      margin-right: 10px;
    }
  }

  .part-content {
    width: 100%;

    .input-unit {
      position: relative;
      margin-right: 10px;
    }

    .unit {
      width: fit-content;
      height: 22px;
      position: absolute;
      top: 8px;
      right: 10px;
      text-align: center;
      line-height: 22px;
      background-color: transparent;
      z-index: 1;
      color: #606266;
    }

    .custom-btn {
      background-color: #fff;
      color: #0c5fff;
    }
  }
}
</style>
